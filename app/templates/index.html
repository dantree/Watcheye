<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>지켜봄 - 모니터링</title>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="/static/css/style.css">
        <link rel="stylesheet" href="/static/css/camera.css">
    </head>
    <body>
        <div class="header">
            <div class="div">
                <div class="div-1">
                    <div class="div-2">
                        <img src="/static/images/logo.png" alt="WATCHEYE" class="img">
                        <div class="span">
                            <div class="ai--">AI 안전감시 시스템</div>
                        </div>
                    </div>
                    <div class="div-3">
                        <div class="current-time">
                            <div class="text--040931"></div>
                        </div>
                        <div class="div-4">
                            <div class="img-1"></div>
                            <div class="span-1">
                                <div class="text-">{{ user.name }}</div>
                            </div>
                        </div>
                        <div class="div-settings">
                            <button class="settings-button">
                                <i class="material-icons">settings</i>
                            </button>
                        </div>
                        <div class="div-5">
                            <button class="button-1" id="notificationButton">
                                <i class="material-icons">notifications</i>
                                <div class="span-2"></div>
                            </button>
                            <div class="modal-backdrop" id="notificationBackdrop"></div>
                            <div class="notification-dropdown" style="display: none;">
                                <div class="notification-header">
                                    <h3>알림 목록</h3>
                                    <button class="clear-all">모두 지우기</button>
                                </div>
                                <div class="notification-list">
                                    <!-- 알림 항목들이 여기에 동적으로 추가됩니다 -->
                                </div>
                            </div>
                        </div>
                        <button class="logout-button">
                            <i class="material-icons">logout</i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="main">
            <div class="div-6">
                <div class="div-7">
                    <div class="div-8">
                        <div class="div-9">
                            <select class="select">
                                <option value="all">모든 카메라</option>
                                {% for camera in cameras %}
                                <option value="{{ camera.id }}">{{ camera.name }}</option>
                                {% endfor %}
                            </select>
                            <button class="button-2">
                                <i class="material-icons">fullscreen</i>
                                <span>전체화면</span>
                            </button>
                        </div>
                        <div class="camera-grid">
                            {% for camera in cameras %}
                            <div class="camera-container">
                                <div class="camera-title">{{ camera.name }}</div>
                                <div class="camera-controls">
                                    <button class="device-connect-btn" data-camera-id="{{ camera.id }}">
                                        <i class="material-icons">videocam</i>
                                        디바이스 연결
                                    </button>
                                </div>
                                <img class="camera-stream" 
                                     src="/api/v1/cameras/{{ camera.id }}/stream" 
                                     alt="{{ camera.name }} 스트림"
                                     data-camera-id="{{ camera.id }}">
                                <div class="camera-offline" style="display: none;">
                                    <i class="material-icons">videocam_off</i>
                                    <span>카메라 오프라인</span>
                                    <button class="connect-camera-btn">
                                        <i class="material-icons">link</i>
                                        카메라 연결
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="div-20">
                    <div class="div-21">
                        <div class="h2-1">
                            <div class="text---2">이벤트 로그</div>
                        </div>
                        <div class="div-22">
                            <!-- 이벤트 로그는 JavaScript에서 동적으로 추가됩니다 -->
                        </div>
                        <div class="div-31">
                            <input type="text" class="input" placeholder="이벤트 검색...">
                            <button class="button-3">
                                <i class="material-icons">search</i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 설정 모달 추가 -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>설정</h2>
                    <button type="button" class="close-button">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm" class="settings-container">
                        <!-- 왼쪽 탭 메뉴 -->
                        <div class="settings-tabs">
                            <button type="button" class="tab-button active" data-tab="general">
                                <i class="material-icons">settings</i>
                                기본설정
                            </button>
                            <button type="button" class="tab-button" data-tab="user">
                                <i class="material-icons">person</i>
                                사용자 관리
                            </button>
                            <button type="button" class="tab-button" data-tab="system">
                                <i class="material-icons">memory</i>
                                시스템 관리
                            </button>
                            <button type="button" class="tab-button" data-tab="camera">
                                <i class="material-icons">videocam</i>
                                카메라 관리
                            </button>
                            <button type="button" class="tab-button" data-tab="alarm">
                                <i class="material-icons">notifications</i>
                                알람 설정
                            </button>
                        </div>
                        
                        <!-- 오른쪽 설정 내용 -->
                        <div class="settings-content">
                            <!-- 기본설정 -->
                            <div class="tab-content active" id="general">
                                <h3>기본설정</h3>
                                <div class="setting-item">
                                    <label>자동 로그아웃 시간 (분)</label>
                                    <input type="number" name="auto_logout_time" min="1" max="120" value="30">
                                </div>
                                <div class="setting-item">
                                    <label>위반 임계값</label>
                                    <input type="number" name="violation_threshold" min="1" max="10" value="3">
                                </div>
                                <div class="setting-item">
                                    <label>
                                        <input type="checkbox" name="notification_sound">
                                        알림음 사용
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 사용자 관리 -->
                            <div class="tab-content" id="user">
                                <h3>사용자 관리</h3>
                                <div class="user-info">
                                    <div class="avatar-section">
                                        <h4>아바타 선택</h4>
                                        <div class="avatar-gallery">
                                            <div class="avatar-option" data-avatar="1">
                                                <img src="/static/images/avatar_1.png" alt="아바타 1">
                                            </div>
                                            <div class="avatar-option" data-avatar="2">
                                                <img src="/static/images/avatar_2.png" alt="아바타 2">
                                            </div>
                                            <div class="avatar-option" data-avatar="3">
                                                <img src="/static/images/avatar_3.png" alt="아바타 3">
                                            </div>
                                            <div class="avatar-option" data-avatar="4">
                                                <img src="/static/images/avatar_4.png" alt="아바타 4">
                                            </div>
                                            <div class="avatar-option" data-avatar="5">
                                                <img src="/static/images/avatar_5.png" alt="아바타 5">
                                            </div>
                                        </div>
                                    </div>
                                    <p><strong>이름:</strong> {{ user.name }}</p>
                                    <div class="position-display">
                                        <strong>직책:</strong>
                                        <div class="position-content">
                                            <span class="position-text">{{ user.position if user.position else '미지정' }}</span>
                                            {% if user.position %}
                                            <button type="button" class="edit-position-btn">수정</button>
                                            {% else %}
                                            <button type="button" class="add-position-btn">입력하기</button>
                                            {% endif %}
                                            <div class="position-edit-container" style="display: none;">
                                                <input type="text" class="position-input" value="{{ user.position if user.position else '' }}" placeholder="직책을 입력하세요">
                                                <button type="button" class="save-position-btn">저장</button>
                                                <button type="button" class="cancel-position-btn">취소</button>
                                            </div>
                                        </div>
                                    </div>
                                    <p><strong>이메일:</strong> {{ user.email }}</p>
                                    <p><strong>연락처:</strong> {{ user.phone }}</p>
                                    <p><strong>최근 로그인:</strong> {{ user.last_login.strftime('%Y-%m-%d %H:%M:%S') if user.last_login else '기록 없음' }}</p>
                                </div>
                            </div>
                            
                            <!-- 시스템 관리 -->
                            <div class="tab-content" id="system">
                                <h3>시스템 관리</h3>
                                <div class="system-info">
                                    <div class="memory-usage">
                                        <h4>메모리 사용량</h4>
                                        <div class="progress-bar">
                                            <div class="progress" style="width: 0%"></div>
                                        </div>
                                        <p class="memory-text">사용중: <span id="memoryUsed">0</span> / 전체: <span id="memoryTotal">0</span></p>
                                    </div>
                                    <div class="setting-item">
                                        <label>AI 감지 민감도</label>
                                        <select name="ai_sensitivity">
                                            <option value="low">낮음</option>
                                            <option value="medium" selected>중간</option>
                                            <option value="high">높음</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="auto_ai_enable">
                                            AI 자동 활성화
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 카메라 관리 -->
                            <div class="tab-content" id="camera">
                                <h3>카메라 관리</h3>
                                <div class="camera-settings">
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="person_detection">
                                            사람 감지
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="helmet_detection">
                                            안전모 감지
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="ppe_detection">
                                            보호구 감지
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="danger_zone_detection">
                                            위험구역 감지
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 알람 설정 -->
                            <div class="tab-content" id="alarm">
                                <h3>알람 설정</h3>
                                <div class="alarm-settings">
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="sms_notification">
                                            SMS 알림
                                        </label>
                                        <input type="tel" name="sms_phone" placeholder="수신 전화번호">
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" name="email_notification">
                                            이메일 알림
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="cancel-button">취소</button>
                            <button type="submit" class="save-button">설정 저장</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- 카메라 연결 모달 추가 -->
        <div id="cameraConnectModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>카메라 연결</h2>
                    <button type="button" class="close-button">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="cameraConnectForm">
        <script src="/static/js/main.js"></script>
        <script src="/static/js/camera.js"></script>
    </body>
</html> 